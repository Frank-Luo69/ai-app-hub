"use strict";(()=>{var e={};e.id=603,e.ids=[603],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},2734:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>P,patchFetch:()=>R,requestAsyncStorage:()=>v,routeModule:()=>q,serverHooks:()=>j,staticGenerationAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{DELETE:()=>h,GET:()=>x,PUT:()=>g});var a=t(9303),n=t(8716),o=t(670),i=t(7070),u=t(7410),p=t(2814);function l(e){let r=process.env.NEXT_PUBLIC_SUPABASE_URL,t=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,s=function(e){let r=e.headers.get("authorization")||e.headers.get("Authorization");if(r&&/^Bearer\s+/i.test(r))return r.replace(/^Bearer\s+/i,"").trim();let t=e.headers.get("x-supabase-auth");return t?t.trim():null}(e);return r&&t?{supabase:(0,p.eI)(r,t,{global:s?{headers:{Authorization:`Bearer ${s}`}}:void 0}),token:s}:{supabase:{from(){let e={select:()=>e,eq:()=>e,single:()=>Promise.reject(Error("not found (mock)")),update:()=>Promise.resolve({data:null,error:{message:"unauthenticated (mock)"}}),delete:()=>Promise.resolve({error:{message:"unauthenticated (mock)"}})};return e},rpc:async()=>({data:!1,error:null}),auth:{getUser:async()=>({data:{user:null},error:null})}},token:s}}async function d(e){let{supabase:r}=l(e),{data:t,error:s}=await r.auth.getUser();return s?null:t.user}let c=u.z.object({title:u.z.string().min(1).optional(),description:u.z.string().max(5e3).optional(),play_url:u.z.string().url().optional(),cover_url:u.z.string().url().nullable().optional(),tags:u.z.array(u.z.string()).optional(),status:u.z.enum(["active","draft","archived"]).optional()});async function m(e,r){let{data:t,error:s}=await e.from("apps").select("*").eq("id",r).single();if(s)throw Error(s.message);return t}function f(e="Forbidden"){return i.NextResponse.json({error:e},{status:403})}async function x(e,{params:r}){let{supabase:t}=l(e);try{let e=await m(t,r.id);return i.NextResponse.json(e)}catch(e){return i.NextResponse.json({error:e?.message||"not found"},{status:404})}}async function g(e,{params:r}){let t=await d(e);if(!t)return f("请先登录");let{supabase:s}=l(e),a=await m(s,r.id).catch(()=>null);if(!a)return i.NextResponse.json({error:"not found"},{status:404});let{data:n}=await s.rpc("is_admin",{uid:t.id});if(a.owner_id!==t.id&&!n)return f();let o=await e.json().catch(()=>({})),u=c.safeParse(o);if(!u.success)return function(e="Bad Request"){return i.NextResponse.json({error:e},{status:400})}(u.error.issues.map(e=>e.message).join(", "));let p=u.data,{data:x,error:g}=await s.from("apps").update(p).eq("id",a.id).select().single();return g?i.NextResponse.json({error:g.message},{status:400}):i.NextResponse.json(x)}async function h(e,{params:r}){let t=await d(e);if(!t)return f("请先登录");let{supabase:s}=l(e),a=await m(s,r.id).catch(()=>null);if(!a)return i.NextResponse.json({error:"not found"},{status:404});let{data:n}=await s.rpc("is_admin",{uid:t.id});if(a.owner_id!==t.id&&!n)return f();let{error:o}=await s.from("apps").delete().eq("id",a.id);return o?i.NextResponse.json({error:o.message},{status:400}):i.NextResponse.json({ok:!0})}let q=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/apps/[id]/route",pathname:"/api/apps/[id]",filename:"route",bundlePath:"app/api/apps/[id]/route"},resolvedPagePath:"/workspaces/ai-app-hub/app/api/apps/[id]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:v,staticGenerationAsyncStorage:w,serverHooks:j}=q,P="/api/apps/[id]/route";function R(){return(0,o.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:w})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,972,514],()=>t(2734));module.exports=s})();