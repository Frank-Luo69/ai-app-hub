(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[416],{8959:function(e,t,r){Promise.resolve().then(r.bind(r,3950))},3950:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var l=r(7437),a=r(2265),n=r(1180),s=r(4768);function o(e){let{params:t}=e,{t:r}=(0,s.Q)(),[o,i]=(0,a.useState)(null),[u,c]=(0,a.useState)(!1),[d,p]=(0,a.useState)(null);async function m(e){if(e.preventDefault(),o){c(!0),p(null);try{var t;let{data:e}=await n.O.auth.getSession(),r=null==e?void 0:null===(t=e.session)||void 0===t?void 0:t.access_token,l=await fetch("/api/apps/".concat(o.id),{method:"PUT",headers:{"Content-Type":"application/json",...r?{Authorization:"Bearer ".concat(r)}:{}},body:JSON.stringify({title:o.title,description:o.description,cover_url:o.cover_url,play_url:o.play_url,tags:o.tags,status:o.status})});if(!l.ok){let e=await l.json().catch(()=>({}));throw Error(e.error||"更新失败")}p("已保存")}catch(e){p(e.message||"保存失败")}finally{c(!1)}}}return((0,a.useEffect)(()=>{n.O.from("apps").select("*").eq("id",t.id).single().then(e=>i(e.data))},[t.id]),o)?(0,l.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,l.jsx)("h1",{className:"text-xl font-semibold mb-4",children:r("edit")}),(0,l.jsxs)("form",{onSubmit:m,className:"space-y-3 card",children:[(0,l.jsx)("input",{className:"w-full border rounded-xl px-3 py-2",value:o.title||"",onChange:e=>i({...o,title:e.target.value}),placeholder:"标题",required:!0}),(0,l.jsx)("textarea",{className:"w-full border rounded-xl px-3 py-2",rows:4,value:o.description||"",onChange:e=>i({...o,description:e.target.value}),placeholder:"简介"}),(0,l.jsx)("input",{className:"w-full border rounded-xl px-3 py-2",value:o.play_url||"",onChange:e=>i({...o,play_url:e.target.value}),placeholder:"链接",required:!0}),(0,l.jsx)("input",{className:"w-full border rounded-xl px-3 py-2",value:o.cover_url||"",onChange:e=>i({...o,cover_url:e.target.value}),placeholder:"封面图链接"}),(0,l.jsx)("input",{className:"w-full border rounded-xl px-3 py-2",value:(o.tags||[]).join(", "),onChange:e=>i({...o,tags:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)}),placeholder:"标签（逗号分隔）"}),(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("label",{className:"text-sm",children:"状态"}),(0,l.jsxs)("select",{className:"border rounded-xl px-2 py-1",value:o.status||"active",onChange:e=>i({...o,status:e.target.value}),children:[(0,l.jsx)("option",{value:"active",children:"active"}),(0,l.jsx)("option",{value:"draft",children:"draft"})]})]}),(0,l.jsx)("button",{className:"btn-primary px-4 py-2 rounded-xl disabled:opacity-50",disabled:u,children:r("edit")}),d&&(0,l.jsx)("div",{className:"text-sm text-gray-600",children:d})]})]}):(0,l.jsx)("div",{children:"加载中…"})}},4768:function(e,t,r){"use strict";r.d(t,{I18nProvider:function(){return o},Q:function(){return i}});var l=r(7437),a=r(2265);let n={zh:{brand:"AI Mini-App Hub",submit:"提交应用",login:"登录",logout:"登出",searchPlaceholder:"搜索应用标题或简介…",noApps:"暂无应用，去「提交应用」发布一个吧～",play:"去玩",myApps:"我的应用",draft:"草稿",published:"已发布",filterAll:"全部",tags:"标签",prev:"上一页",next:"下一页",edit:"编辑",delete:"删除"},en:{brand:"AI Mini-App Hub",submit:"Submit App",login:"Login",logout:"Logout",searchPlaceholder:"Search by title or description…",noApps:"No apps yet — submit one!",play:"Play",myApps:"My Apps",draft:"Draft",published:"Published",filterAll:"All",tags:"Tags",prev:"Prev",next:"Next",edit:"Edit",delete:"Delete"}},s=(0,a.createContext)({t:e=>e,lang:"zh",setLang:()=>{}});function o(e){let{children:t}=e,[r,o]=(0,a.useState)("zh");(0,a.useEffect)(()=>{let e=localStorage.getItem("lang");("en"===e||"zh"===e)&&o(e)},[]),(0,a.useEffect)(()=>{localStorage.setItem("lang",r)},[r]);let i=(0,a.useMemo)(()=>e=>{var t;return null!==(t=n[r][e])&&void 0!==t?t:e},[r]),u=(0,a.useMemo)(()=>({t:i,lang:r,setLang:o}),[i,r]);return(0,l.jsx)(s.Provider,{value:u,children:t})}function i(){return(0,a.useContext)(s)}},1180:function(e,t,r){"use strict";r.d(t,{O:function(){return o}});var l=r(4593),a=r(357);let n=a.env.NEXT_PUBLIC_SUPABASE_URL,s=a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,o=n&&s?(0,l.eI)(n,s):function(){let e=()=>{};return{from(e){let t={table:e,filter:{}},r={select:()=>r,eq:(e,l)=>(t.filter[e]=l,r),order:()=>Promise.resolve({data:[],error:null}),single:()=>"apps"===t.table&&"e2e-demo"===t.filter.slug?Promise.resolve({data:{id:"e2e-app-1",title:"E2E Demo App",slug:"e2e-demo",description:"Mock app for e2e without backend",cover_url:null,play_url:"https://example.com",source_host:"example.com",tags:["demo"],status:"active",owner_id:"owner-1",created_at:new Date().toISOString()},error:null}):Promise.resolve({data:null,error:{message:"not found (mock)"}}),insert:()=>Promise.resolve({data:null,error:{message:"unauthenticated (mock)"}}),update:()=>Promise.resolve({data:null,error:{message:"unauthenticated (mock)"}}),delete:()=>Promise.resolve({error:{message:"unauthenticated (mock)"}})};return r},rpc:async()=>({data:!1,error:null}),auth:{getUser:async()=>({data:{user:null},error:null}),getSession:async()=>({data:{session:null},error:null}),onAuthStateChange:(t,r)=>({subscription:{unsubscribe:e}}),signOut:async()=>({error:null})},channel:()=>({on:()=>({subscribe:()=>({})})}),removeChannel:e}}()}},function(e){e.O(0,[816,971,23,744],function(){return e(e.s=8959)}),_N_E=e.O()}]);